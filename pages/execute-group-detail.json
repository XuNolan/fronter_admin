{
  "type": "page",
  "title": "执行组详情",
  "initApi": "http://127.0.0.1:8080/execute-group/detail/${params.id}",
  "body": [
    {
      "type": "grid",
      "columns": [
        {
          "type": "panel",
          "title": "脚本列表（按执行顺序）",
          "className": "m-r",
          "md": 8,
          "body": [
            {
              "type": "crud",
              "source": "${scripts}",
              "syncLocation": false,
              "perPageAvailable": [10, 20, 50],
              "perPage": 10,
              "columns": [
                {
                  "name": "index",
                  "label": "执行顺序",
                  "type": "text",
                  "width": 80
                },
                {
                  "name": "scriptId",
                  "label": "脚本ID",
                  "type": "text",
                  "width": 80
                },
                {
                  "name": "usecaseName",
                  "label": "用例名",
                  "type": "text"
                },
                {
                  "name": "scriptName",
                  "label": "脚本名",
                  "type": "text"
                },
                {
                  "name": "version",
                  "label": "版本",
                  "type": "text",
                  "width": 80
                },
                {
                  "name": "isActive",
                  "label": "状态",
                  "type": "mapping",
                  "width": 80,
                  "map": {
                    "true": "<span class='label label-success'>已启用</span>",
                    "false": "<span class='label label-default'>未启用</span>"
                  }
                },
                {
                  "type": "operation",
                  "label": "操作",
                  "width": 100,
                  "buttons": [
                    {
                      "type": "button",
                      "label": "查看详情",
                      "level": "link",
                      "actionType": "link",
                      "link": "/usecase/query/${usecaseId}"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "panel",
          "title": "执行组信息",
          "md": 4,
          "body": [
            {
              "type": "form",
              "mode": "horizontal",
              "wrapWithPanel": false,
              "body": [
                {
                  "type": "static",
                  "name": "id",
                  "label": "执行组ID"
                },
                {
                  "type": "static",
                  "name": "groupName",
                  "label": "执行组名"
                },
                {
                  "type": "static",
                  "name": "created",
                  "label": "创建时间",
                  "tpl": "${created | date:YYYY-MM-DD HH\\:mm\\:ss}"
                },
                {
                  "type": "static",
                  "name": "updated",
                  "label": "更新时间",
                  "tpl": "${updated | date:YYYY-MM-DD HH\\:mm\\:ss}"
                }
              ]
            },
            {
              "type": "divider"
            },
            {
              "type": "button",
              "label": "编辑执行组",
              "level": "primary",
              "actionType": "dialog",
              "dialog": {
                "title": "编辑执行组",
                "size": "lg",
                "body": {
                  "type": "form",
                  "api": {
                    "method": "post",
                    "url": "http://127.0.0.1:8080/execute-group/update/${params.id}"
                  },
                  "initApi": "http://127.0.0.1:8080/execute-group/detail/${params.id}",
                  "body": [
                    {
                      "type": "input-text",
                      "name": "groupName",
                      "label": "执行组名",
                      "required": true,
                      "placeholder": "请输入执行组名称（不可重复）",
                      "minLength": 1,
                      "maxLength": 32,
                      "showCounter": true,
                      "clearable": true
                    },
                    {
                      "type": "combo",
                      "name": "scripts",
                      "label": "关联脚本",
                      "multiple": true,
                      "draggable": true,
                      "addable": true,
                      "removable": true,
                      "draggableTip": "拖拽调整执行顺序",
                      "addButtonText": "添加脚本",
                      "items": [
                        {
                          "type": "select",
                          "name": "scriptId",
                          "label": "选择脚本",
                          "required": true,
                          "source": {
                            "method": "get",
                            "url": "http://127.0.0.1:8080/execute-group/available-scripts",
                            "adaptor": "return payload.data;"
                          },
                          "labelField": "label",
                          "valueField": "value",
                          "searchable": true,
                          "placeholder": "选择脚本"
                        }
                      ],
                      "description": "拖拽调整顺序，第一个脚本将最先执行"
                    }
                  ],
                  "actions": [
                    {
                      "type": "button",
                      "label": "取消",
                      "actionType": "cancel"
                    },
                    {
                      "type": "submit",
                      "label": "保存",
                      "level": "primary"
                    }
                  ]
                }
              }
            },
            {
              "type": "divider"
            },
            {
              "type": "button",
              "label": "连续执行此组所有脚本",
              "level": "success",
              "size": "lg",
              "actionType": "ajax",
              "confirmText": "确认要顺序执行此组中的所有脚本吗？",
              "api": {
                "method": "post",
                "url": "http://127.0.0.1:8080/execute-group/execute/${params.id}"
              }
            },
            {
              "type": "divider"
            },
            {
              "type": "button",
              "label": "返回列表",
              "actionType": "link",
              "link": "/execute-group/list"
            }
          ]
        }
      ]
    },
    {
      "type": "grid",
      "columns": [
        {
          "type": "panel",
          "title": "执行批次列表",
          "md": 6,
          "body": [
            {
              "type": "crud",
              "id": "u:groupBatchCrud",
              "syncLocation": false,
              "api": {
                "method": "get",
                "url": "http://127.0.0.1:8080/execute-group/batches/${params.id}"
              },
              "columns": [
                { "name": "executeTermId", "label": "执行批次UUID", "type": "tpl", "tpl": "${executeTermId}" },
                { "name": "created", "label": "开始时间", "type": "tpl", "tpl": "${created | date:YYYY-MM-DD HH\\:mm\\:ss}", "width": 160 },
                { "name": "count", "label": "脚本数", "type": "text", "width": 70 },
                { "name": "successCount", "label": "成功数", "type": "text", "width": 70 },
                {
                  "type": "operation",
                  "label": "操作",
                  "width": 160,
                  "buttons": [
                    {
                      "type": "button",
                      "label": "查看详情",
                      "level": "link",
                      "onEvent": {
                        "click": {
                          "actions": [
                            { "componentId": "u:groupBatchDetailService", "actionType": "setValue", "args": { "value": { "executeTermId": "${executeTermId}" } } },
                            { "componentId": "u:groupBatchDetailService", "actionType": "reload" }
                          ]
                        }
                      }
                    },
                    {
                      "type": "button",
                      "label": "删除",
                      "level": "danger",
                      "actionType": "dialog",
                      "dialog": {
                        "title": "危险操作确认",
                        "body": [
                          { "type": "alert", "body": "会删除当前执行批次下所有日志记录和所有录制记录，且不可恢复。", "level": "danger" },
                          {
                            "type": "form",
                            "wrapWithPanel": false,
                            "mode": "horizontal",
                            "actions": [
                              {
                                "type": "button",
                                "label": "取消",
                                "actionType": "close"
                              },
                              {
                                "type": "button",
                                "label": "确认删除",
                                "level": "danger",
                                "actionType": "ajax",
                                "api": {
                                  "url": "http://127.0.0.1:8080/execute-group/batch/delete",
                                  "method": "post",
                                  "data": { "groupId": "${params.id}", "executeTermId": "${executeTermId}" }
                                },
                                "onEvent": {
                                  "success": {
                                    "actions": [
                                      { "actionType": "closeDialog" },
                                      { "componentId": "u:groupBatchCrud", "actionType": "reload" },
                                      { "componentId": "u:groupBatchDetailService", "actionType": "setValue", "args": { "value": { "executeTermId": null } } },
                                      { "componentId": "u:groupBatchDetailService", "actionType": "reload" }
                                    ]
                                  }
                                }
                              }
                            ]
                          }
                        ]
                      }
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "panel",
          "title": "批次详情：日志与录制",
          "md": 6,
          "body": [
            {
              "type": "service",
              "id": "u:groupBatchDetailService",
              "api": {
                "method": "get",
                "url": "http://127.0.0.1:8080/execute-group/batch/detail?groupId=${params.id}&executeTermId=${executeTermId}"
              },
              "initFetch": false,
              "initFetchOn": "executeTermId",
              "body": [
                {
                  "type": "crud",
                  "id": "u:groupBatchDetailCrud",
                  "source": "${data.items}",
                  "syncLocation": false,
                  "columns": [
                    { "name": "executeLogId", "label": "日志ID", "type": "text", "width": 70 },
                    { "name": "scriptId", "label": "脚本ID", "type": "text", "width": 70 },
                    { "name": "scriptName", "label": "脚本名", "type": "tpl", "tpl": "${scriptName || '-'}", "width": 140 },
                    { "name": "created", "label": "测试时间", "type": "tpl", "tpl": "${created | date:YYYY-MM-DD HH\\:mm\\:ss}", "width": 160 },
                    { "name": "statusText", "label": "执行状态", "type": "mapping", "map": { "成功": "<span class='label label-success'>成功</span>", "失败": "<span class='label label-danger'>失败</span>", "中止/进行中": "<span class='label label-warning'>中止/进行中</span>" } },
                    { "name": "hasRecord", "label": "录制状态", "type": "mapping", "map": { "true": "<span class='label label-info'>已录制</span>", "false": "<span class='label label-default'>未录制</span>" } },
                    {
                      "type": "operation",
                      "label": "操作",
                      "width": 220,
                      "buttons": [
                        { "type": "button", "label": "查看详情", "level": "link", "actionType": "link", "link": "/pages/executeLogDetail.html?id=${executeLogId}" },
                        { "type": "button", "label": "删除录制", "level": "danger", "actionType": "ajax", "api": { "url": "http://127.0.0.1:8080/execute-log/delete", "method": "post", "data": { "executeLogId": "${executeLogId}", "deleteLog": false, "deleteRecord": true } }, "reload": "u:groupBatchDetailService" },
                        { "type": "button", "label": "全部删除", "level": "danger", "actionType": "ajax", "confirmText": "确认删除日志和录制？", "api": { "url": "http://127.0.0.1:8080/execute-log/delete", "method": "post", "data": { "executeLogId": "${executeLogId}", "deleteLog": true, "deleteRecord": true } }, "reload": "u:groupBatchDetailService" }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
